<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Internship & Class Schedule</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fdfbff; /* Even softer, almost white with a very faint lavender hint */
            /* Seamless, wrapping heart pattern */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23fce7f3' fill-opacity='0.6'%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(37.5,36.875) scale(0.25)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(12.5, -9.875) scale(0.15)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(12.5, 90.125) scale(0.15)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(95, 69.5) scale(0.2)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(-5, 69.5) scale(0.2)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(75, 19.75) scale(0.1)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(-12, 94.55) scale(0.18)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(88, 94.55) scale(0.18)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(-12, -5.45) scale(0.18)'/%3E%3Cpath d='M50 85L45.5 80.8C26.5 63.4 14 51.9 14 37.5C14 28.1 21.5 20 31 20C36.5 20 41.5 23.5 45 28.5L50 35L55 28.5C58.5 23.5 63.5 20 69 20C78.5 20 86 28.1 86 37.5C86 51.9 73.5 63.4 54.5 80.8L50 85Z' transform='translate(88, -5.45) scale(0.18)'/%3E%3C/g%3E%3C/svg%3E");
            background-repeat: repeat;
            background-size: 12%; /* Increased size for a sparser, larger pattern */
            background-position: top left;
            background-attachment: scroll;
        }
        .schedule-card {
            background-color: rgba(255, 255, 255, 0.9); /* Slightly translucent white */
            border-radius: 1.75rem; /* Even more rounded corners */
            box-shadow: 0 20px 30px -8px rgba(0, 0, 0, 0.08), 0 10px 15px -7px rgba(0, 0, 0, 0.04); /* Lighter, softer shadow */
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            border: 1px solid rgba(255, 255, 255, 0.8); /* More visible, soft white border */
        }
        .schedule-card:hover {
            transform: translateY(-10px); /* More pronounced lift on hover */
            box-shadow: 0 25px 40px -10px rgba(0, 0, 0, 0.12), 0 12px 20px -8px rgba(0, 0, 0, 0.06);
        }
        .event-item {
            border-left-width: 6px; /* Slightly thicker left border */
            border-radius: 1rem; /* More rounded corners for events */
            padding: 0.9rem 1.3rem;
            margin-bottom: 0.7rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(135deg, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.95) 100%); /* Subtle gradient for events */
            box-shadow: 0 3px 6px -2px rgba(0, 0, 0, 0.03); /* Even softer shadow for event items */
            transition: all 0.3s ease-in-out;
        }
        @media (min-width: 640px) {
            .event-item {
                flex-direction: row;
                align-items: center;
            }
        }
        .internship-event {
            border-color: #d2b4de; /* Soft lavender purple for internship */
            background-color: #f9f0ff; /* Very light, almost white purple background */
        }
        .class-event {
            border-color: #ff88aa; /* More saturated pastel pink for classes */
            background-color: #fff0f5; /* Very light, almost white pink background */
        }
        /* Style for the currently active event */
        .current-event {
            border-left-color: #22d3ee; /* A vibrant, friendly cyan */
            box-shadow: 0 0 25px -5px rgba(34, 211, 238, 0.7); /* Soft glow effect */
            transform: scale(1.02);
        }
        /* Refined Tag Styling */
        .sync-tag, .async-tag, .week-sync-tag, .week-async-tag {
            padding: 0.2rem 0.8rem; /* More padding for a softer pill shape */
            border-radius: 9999px;
            font-size: 0.8rem; /* Slightly larger font for readability */
            font-weight: 500; /* Slightly less bold */
            display: inline-flex;
            align-items: center;
            justify-content: center;
            white-space: nowrap;
            text-shadow: none; /* Removed text shadow for a cleaner look */
            background-color: transparent; /* Make background transparent */
            box-shadow: none; /* Remove box shadow */
            color: #6d8299; /* Default text color for tags */
        }

        /* Specific style for location tags to make them truly invisible */
        .location-tag {
            padding: 0; /* Remove padding */
            border-radius: 0; /* Remove border-radius */
            background-color: transparent; /* Ensure transparent background */
            box-shadow: none; /* Ensure no box shadow */
            color: #6d8299; /* Maintain text color */
            white-space: nowrap; /* Keep text on one line */
            font-size: 0.8rem; /* Consistent font size */
            font-weight: 500; /* Consistent font weight */
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem; /* Slightly larger gap between tags for clarity */
            margin-top: 0.7rem; /* Space above tags on small screens */
        }
        @media (min-width: 640px) {
            .tag-container {
                margin-top: 0;
            }
        }


        .action-button {
            background: linear-gradient(45deg, #f7cac9, #d2b4de); /* Soft pink to lavender gradient */
            color: white;
            padding: 0.9rem 2rem; /* Even larger padding */
            border-radius: 1.25rem; /* More rounded */
            font-weight: 700;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 8px 15px -3px rgba(247, 202, 201, 0.5), 0 4px 8px -2px rgba(210, 180, 222, 0.3); /* Softer, combined shadow */
            border: none;
            cursor: pointer;
        }
        .action-button:hover {
            background: linear-gradient(45deg, #d2b4de, #f7cac9); /* Reverse gradient on hover */
            transform: translateY(-5px) scale(1.03); /* More pronounced lift and scale */
            box-shadow: 0 10px 20px -4px rgba(247, 202, 201, 0.7), 0 5px 10px -3px rgba(210, 180, 222, 0.4);
        }
        .action-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #9c27b0; /* A soft, elegant purple for heading */
            text-shadow: 1px 1px 4px rgba(255,255,255,0.9); /* More prominent soft white shadow */
        }
        h2 {
            color: #c084fc; /* A slightly lighter purple for day titles */
            text-shadow: 0.5px 0.5px 3px rgba(255,255,255,0.8);
        }
        .event-item p {
            color: #6b7280; /* Softer grey for event details */
        }
        .event-item p.text-lg {
            color: #4a5252; /* Slightly darker for event name for readability */
        }

        /* Week View Specific Styles */
        .week-grid-container {
            display: grid;
            /* First column for time, then 5 columns for Mon-Fri */
            grid-template-columns: 80px repeat(5, 1fr); 
            gap: 1px; /* Very small gap for grid lines */
            background-color: #e2e8f0; /* Light grey for grid lines */
            border-radius: 1rem;
            /* Removed overflow: hidden; to allow absolute positioned events to extend */
            box-shadow: 0 10px 20px -5px rgba(0,0,0,0.1);
            border: 2px solid #cbd5e1; /* Stronger border for the entire grid */
        }

        /* Apply borders to all direct children of the grid container */
        .week-grid-container > div {
            border-bottom: 1px solid #e2e8f0;
            border-right: 1px solid #e2e8f0;
        }

        /* Remove right border from cells in the last column */
        .week-grid-container > div:nth-child(6n) { /* Selects every 6th element (last column) */
            border-right: none;
        }
        /* Remove bottom border from cells in the last row */
        /* This targets the last row of cells (including the time slot column) */
        .week-grid-container > div:nth-last-child(-n + 6) { /* Selects the last 6 elements (last full row) */
            border-bottom: none;
        }


        .week-grid-header {
            padding: 0.75rem 0.2rem;
            font-weight: 700;
            background-color: #f0f4f8; /* Slightly darker header */
            color: #6b7280;
            border-bottom: 2px solid #cbd5e1; /* Thicker border below header */
        }

        .week-grid-time-slot {
            justify-content: flex-end;
            padding-right: 0.5rem;
            font-weight: 500; /* Reverted to 500 for consistency */
            background-color: #f8fafc; /* Lighter background for time column */
            position: sticky; /* Make time column sticky */
            left: 0;
            z-index: 10; /* Ensure it's above events */
            white-space: nowrap; /* Prevent time labels on the left from wrapping */
            color: #94a3b8; /* Lighter color for time labels */
        }
        /* Ensure the top-left corner header has its right border */
        .week-grid-container > .week-grid-header:first-child {
            border-right: 1px solid #e2e8f0;
        }


        .week-grid-cell {
            position: relative; /* Crucial: For positioning events within cells */
            height: 40px; /* Exact height for a 30-minute slot */
        }

        .week-event-block {
            position: absolute;
            left: 2px; /* Ensure it's within the cell horizontally */
            right: 2px; /* Ensure it's within the cell horizontally */
            padding: 0.3rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            /* Allow text to wrap */
            white-space: normal; 
            /* Added for horizontal clipping of content */
            overflow-x: hidden; 
            text-overflow: clip; /* Ensure no ellipsis on the block itself */

            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 5; /* Ensure events are above grid lines */
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            display: flex; /* Use flexbox for vertical alignment of content */
            flex-direction: column;
            justify-content: flex-start; /* Align wrapped text to the top */
        }

        .week-event-block > p.text-xs { /* Target the time paragraph specifically */
            white-space: nowrap; /* Prevent wrapping of the time string */
            overflow: hidden; /* Hide overflowing text */
            text-overflow: ellipsis; /* Show ellipsis for clipped text */
            width: 100%; /* Ensure it takes full available width of its parent */
            box-sizing: border-box; /* Include padding in width calculation */
            padding: 0; /* Remove padding from the time text itself to maximize space */
        }


        .week-event-block:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .week-internship-event {
            background-color: #e9d5ff; /* Light purple */
            border-left: 4px solid #a78bfa; /* Deeper purple */
            color: #5b21b6; /* Darker text */
        }

        .week-class-event {
            background-color: #ffe4e6; /* Light pink */
            border-left: 4px solid #f472b6; /* Deeper pink */
            color: #be185d; /* Darker text */
        }

        .week-current-event {
            border-left-color: #22d3ee; /* Cyan highlight */
            box-shadow: 0 0 15px -3px rgba(34, 211, 238, 0.7);
            z-index: 15; /* Bring current event to front */
        }

        /* Responsive adjustments for week view */
        @media (max-width: 768px) {
            .week-grid-container {
                grid-template-columns: 60px repeat(5, 1fr); /* Smaller time column */
                font-size: 0.7rem;
            }
            .week-grid-header, .week-grid-time-slot, .week-grid-cell {
                padding: 0.3rem 0.1rem;
            }
            .week-event-block {
                font-size: 0.65rem;
                padding: 0.2rem 0.3rem;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8 md:p-12 lg:p-16">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center mb-10">
            My Weekly Schedule
        </h1>

        <!-- Legend for event types -->
        <div class="mb-8 p-4 bg-white rounded-xl shadow-md flex flex-wrap justify-center gap-4 text-sm font-medium">
            <div class="flex items-center">
                <span class="w-4 h-4 rounded-full bg-purple-300 mr-2"></span>
                <span>Internship</span>
            </div>
            <div class="flex items-center">
                <span class="w-4 h-4 rounded-full bg-pink-300 mr-2"></span>
                <span>Classes</span>
            </div>
            <div class="flex items-center">
                <span class="px-2 py-1 rounded-md bg-blue-100 text-gray-700 mr-2">Sync</span>
                <span>Synchronous</span>
            </div>
            <div class="flex items-center">
                <span class="px-2 py-1 rounded-md bg-yellow-100 text-gray-700 mr-2">Async</span>
                <span>Asynchronous</span>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-center gap-6 mb-8">
            <button id="show-today-btn" class="action-button">Show Today's Schedule</button>
            <button id="show-all-btn" class="action-button">Show All Days</button>
            <button id="show-week-btn" class="action-button">Show Week View</button>
        </div>

        <!-- Daily/All Days Schedule Container -->
        <div id="daily-schedule-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Schedule content for daily/all days view will be injected here by JavaScript -->
        </div>

        <!-- Week View Schedule Container -->
        <div id="week-schedule-container" class="hidden relative">
            <!-- Week view content will be injected here by JavaScript -->
        </div>
    </div>

    <script>
        // Schedule data structured for easy rendering
        const scheduleData = {
            Monday: [
                { type: 'internship', time: '9:00 AM - 11:00 AM', name: 'Dev Degree Kickoff', sync: true, location: 'Online' },
                { type: 'internship', time: '11:00 AM - 5:00 PM', name: 'Dev Degree Work Period', sync: false, location: 'Remote' }
            ],
            Tuesday: [
                { type: 'class', time: '8:35 AM - 11:25 AM', name: 'Intro to CS', location: 'Southam Hall 306', sync: true },
                { type: 'class', time: '11:35 AM - 12:25 PM', name: 'Discrete Structures', location: 'Nicol Building 3020', sync: true },
                { type: 'internship', time: '1:00 PM - 2:00 PM', name: 'Shopify Misc Work', sync: false, location: 'Remote' },
                { type: 'internship', time: '2:00 PM - 5:00 PM', name: 'Dev Degree Work Period', sync: false, location: 'Remote' }
            ],
            Wednesday: [
                { type: 'internship', time: '9:00 AM - 10:30 AM', name: 'Shopify Misc Work', sync: false, location: 'Remote' },
                { type: 'class', time: '11:35 AM - 2:25 PM', name: 'Intro to CS', location: 'Nicol Building 4010', sync: true },
                { type: 'class', time: '2:35 PM - 3:55 PM', name: 'Discrete Structures', location: 'Richcraft Hall 2200', sync: true },
                { type: 'internship', time: '4:00 PM - 5:00 PM', name: 'Shopify Misc Work', sync: false, location: 'Remote' }
            ],
            Thursday: [
                { type: 'class', time: '8:35 AM - 11:25 AM', name: 'Intro to CS', location: 'Southam Hall 306', sync: true },
                { type: 'internship', time: '12:00 PM - 1:00 PM', name: 'Shopify Misc Work', sync: false, location: 'Remote' },
                { type: 'internship', time: '1:00 PM - 3:00 PM', name: 'Dev Degree Pair Programming', sync: true, location: 'Online' },
                { type: 'internship', time: '3:00 PM - 5:00 PM', name: 'Dev Degree Work Period', sync: false, location: 'Remote' }
            ],
            Friday: [
                { type: 'internship', time: '9:00 AM - 10:30 AM', name: 'Dev Degree Work Period', sync: false, location: 'Remote' },
                { type: 'internship', time: '10:30 AM - 12:00 PM', name: 'Dev Degree Coffee & Code', sync: true, location: 'Online' },
                { type: 'internship', time: '12:00 PM - 2:00 PM', name: 'Dev Degree Work Period', sync: false, location: 'Remote' },
                { type: 'class', time: '2:35 PM - 3:55 PM', name: 'Discrete Structures', location: 'Richcraft Hall 2200', sync: true }, /* Changed to 5:00 PM for testing */
                { type: 'internship', time: '4:00 PM - 5:00 PM', name: 'Shopify Misc Work', sync: false, location: 'Remote' }
            ]
        };

        const dailyScheduleContainer = document.getElementById('daily-schedule-container');
        const weekScheduleContainer = document.getElementById('week-schedule-container');
        const showTodayBtn = document.getElementById('show-today-btn');
        const showAllBtn = document.getElementById('show-all-btn');
        const showWeekBtn = document.getElementById('show-week-btn');

        /**
         * Parses a time string (e.g., "9:00 AM") and returns a Date object for today.
         * @param {string} timeStr - The time string to parse.
         * @param {Date} date - The base date to set the time on.
         * @returns {Date} A Date object with today's date and the parsed time.
         */
        function parseTime(timeStr, date) {
            const [time, modifier] = timeStr.split(' ');
            let [hours, minutes] = time.split(':');

            let parsedHours = parseInt(hours, 10);
            const parsedMinutes = parseInt(minutes, 10);

            if (modifier && modifier.toUpperCase() === 'PM' && parsedHours !== 12) {
                parsedHours += 12;
            } else if (modifier && modifier.toUpperCase() === 'AM' && parsedHours === 12) {
                parsedHours = 0; // 12 AM is 00 hours
            }

            const eventDate = new Date(date);
            eventDate.setHours(parsedHours, parsedMinutes, 0, 0);
            return eventDate;
        }

        /**
         * Checks if an event is happening right now.
         * @param {object} event - The event object with a 'time' property.
         * @param {Date} now - The current date and time.
         * @returns {boolean} True if the event is currently active.
         */
        function isCurrentEvent(event, now) {
            try {
                const [startTimeStr, endTimeStr] = event.time.split(' - ');
                const startTime = parseTime(startTimeStr, now);
                const endTime = parseTime(endTimeStr, now);
                return now >= startTime && now <= endTime;
            } catch (e) {
                console.error("Error parsing time for event:", event, e);
                return false;
            }
        }

        /**
         * Get the current day of the week name (e.g., "Monday").
         * @returns {string} The name of the current day.
         */
        function getTodayName() {
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const date = new Date();
            return days[date.getDay()];
        }

        /**
         * Renders the daily or all-days schedule view.
         * @param {string|null} filterDay - The specific day to filter by, or null for all days.
         */
        function renderDailyView(filterDay = null) {
            dailyScheduleContainer.innerHTML = ''; // Clear previous content
            dailyScheduleContainer.classList.remove('hidden');
            weekScheduleContainer.classList.add('hidden');

            const daysToRender = filterDay ? [filterDay] : Object.keys(scheduleData);
            
            const now = new Date();
            const todayName = getTodayName();

            if (daysToRender.length === 0) {
                const noScheduleMessage = document.createElement('div');
                noScheduleMessage.className = 'schedule-card p-6 text-center text-gray-600 col-span-full';
                noScheduleMessage.textContent = 'No schedule information available.';
                dailyScheduleContainer.appendChild(noScheduleMessage);
                return;
            }

            daysToRender.forEach(day => {
                const events = scheduleData[day];
                if (events && events.length > 0) {
                    const dayCard = document.createElement('div');
                    dayCard.className = 'schedule-card p-6';

                    dayCard.innerHTML = `<h2 class="text-2xl font-bold mb-4">${day}</h2>`;

                    events.forEach(event => {
                        const eventDiv = document.createElement('div');
                        
                        const isCurrent = (day === todayName) && isCurrentEvent(event, now);

                        const eventTypeClass = event.type === 'internship' ? 'internship-event' : 'class-event';
                        eventDiv.className = `event-item ${eventTypeClass} ${isCurrent ? 'current-event' : ''}`;

                        // Determine the location text based on event type
                        let locationTagHtml = '';
                        if (event.type === 'internship') { // Show Sync/Async for internships
                            const tagClass = event.sync ? 'sync-tag' : 'async-tag';
                            locationTagHtml = `<span class="${tagClass}">${event.sync ? 'Sync' : 'Async'}</span>`;
                        } else if (event.location) { // For classes, show the actual location if it exists
                            locationTagHtml = `<span class="location-tag">${event.location}</span>`;
                        }


                        eventDiv.innerHTML = `
                            <div>
                                <p class="text-sm font-semibold text-gray-700">${event.time}</p>
                                <p class="text-lg font-medium text-gray-900">${event.name}</p>
                            </div>
                            <div class="tag-container">
                                ${locationTagHtml}
                            </div>
                        `;
                        dayCard.appendChild(eventDiv);
                    });
                    dailyScheduleContainer.appendChild(dayCard);
                } else if (filterDay) {
                    const noEventsMessage = document.createElement('div');
                    noEventsMessage.className = 'schedule-card p-6 text-center text-gray-600';
                    noEventsMessage.textContent = `No scheduled events for ${day}. Enjoy your day!`;
                    dailyScheduleContainer.appendChild(noEventsMessage);
                }
            });

            if (dailyScheduleContainer.innerHTML === '') {
                const noScheduleMessage = document.createElement('div');
                noScheduleMessage.className = 'schedule-card p-6 text-center text-gray-600 col-span-full';
                noScheduleMessage.textContent = 'No schedule information available.';
                dailyScheduleContainer.appendChild(noScheduleMessage);
            }
        }

        /**
         * Renders the week view schedule.
         */
        function renderWeekView() {
            dailyScheduleContainer.classList.add('hidden');
            weekScheduleContainer.classList.remove('hidden');
            weekScheduleContainer.innerHTML = ''; // Clear previous content

            const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const timeSlots = [];
            const gridStartTimeHours = 8;
            const gridStartTimeMinutesOffset = 30; // Start at 8:30 AM
            const gridEndTimeHours = 17; // End at 5:00 PM
            const slotDurationMinutes = 30; // Each row is 30 minutes
            const cellHeightPx = 40; // Height of a single 30-minute cell in pixels

            // Generate time slots from 8:30 AM to 5:00 PM
            for (let h = gridStartTimeHours; h <= gridEndTimeHours; h++) {
                if (h === gridStartTimeHours) {
                    // Start with 8:30 AM
                    timeSlots.push(`${h % 12 === 0 ? 12 : h % 12}:30 ${h < 12 ? 'AM' : 'PM'}`);
                } else {
                    // Add :00 and :30 for subsequent hours
                    timeSlots.push(`${h % 12 === 0 ? 12 : h % 12}:00 ${h < 12 ? 'AM' : 'PM'}`);
                    if (h < gridEndTimeHours) { 
                        timeSlots.push(`${h % 12 === 0 ? 12 : h % 12}:30 ${h < 12 ? 'AM' : 'PM'}`);
                    }
                }
            }
            // Ensure 5:00 PM is explicitly added if the loop ends at 17:00
            const lastTimeSlot = `${gridEndTimeHours % 12 === 0 ? 12 : gridEndTimeHours % 12}:00 ${gridEndTimeHours < 12 ? 'AM' : 'PM'}`;
            if (!timeSlots.includes(lastTimeSlot)) {
                timeSlots.push(lastTimeSlot);
            }
            // Add an extra 30-minute slot to ensure events ending at 5:00 PM are fully visible
            const extraTimeSlot = `${gridEndTimeHours % 12 === 0 ? 12 : gridEndTimeHours % 12}:30 ${gridEndTimeHours < 12 ? 'AM' : 'PM'}`;
            timeSlots.push(extraTimeSlot);


            const now = new Date();
            const todayName = getTodayName();

            // Create the main grid container
            const grid = document.createElement('div');
            grid.className = 'week-grid-container';
            // Set grid-template-rows dynamically based on timeSlots length
            grid.style.gridTemplateRows = `auto repeat(${timeSlots.length}, 40px)`; /* Fixed pixel height for rows */

            // Store references to the grid cells for easier event placement
            const gridCells = {}; // { 'Monday': [cell1, cell2, ...], 'Tuesday': [...] }

            // Add empty top-left corner for header
            const cornerHeader = document.createElement('div');
            cornerHeader.className = 'week-grid-header';
            grid.appendChild(cornerHeader);

            // Add day headers
            daysOfWeek.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'week-grid-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
                gridCells[day] = []; // Initialize array for this day's cells
            });

            // Add time slots and event cells
            timeSlots.forEach((time, timeIndex) => { // Added timeIndex
                const timeSlotDiv = document.createElement('div');
                timeSlotDiv.className = 'week-grid-time-slot';
                timeSlotDiv.textContent = time;
                grid.appendChild(timeSlotDiv);

                daysOfWeek.forEach(day => {
                    const cell = document.createElement('div');
                    cell.className = 'week-grid-cell';
                    grid.appendChild(cell);
                    gridCells[day].push(cell); // Store reference to this cell
                });
            });

            // Populate events
            daysOfWeek.forEach((day, dayIndex) => {
                const events = scheduleData[day];
                if (events) {
                    events.forEach(event => {
                        try {
                            const [startTimeStr, endTimeStr] = event.time.split(' - ');
                            const startTime = parseTime(startTimeStr, now);
                            const endTime = parseTime(endTimeStr, now);

                            const startMinutes = startTime.getHours() * 60 + startTime.getMinutes();
                            const endMinutes = endTime.getHours() * 60 + endTime.getMinutes();

                            // Calculate grid start time in minutes from midnight (8:30 AM)
                            const gridStartTimeMinutesCalculated = gridStartTimeHours * 60 + gridStartTimeMinutesOffset;

                            // Calculate the starting slot index (integer)
                            const startSlotIndex = Math.floor((startMinutes - gridStartTimeMinutesCalculated) / slotDurationMinutes);
                            
                            // Calculate the offset in minutes within that starting slot
                            const offsetInSlotMinutes = (startMinutes - gridStartTimeMinutesCalculated) % slotDurationMinutes;

                            // Calculate total duration in minutes
                            const totalDurationMinutes = endMinutes - startMinutes;

                            if (startSlotIndex < 0 || totalDurationMinutes <= 0) {
                                console.warn(`Event ${event.name} on ${day} has invalid time calculation or is outside grid range. Start: ${startTimeStr}, End: ${endTimeStr}`);
                                return;
                            }

                            // Find the correct starting cell for this event
                            const targetCell = gridCells[day][startSlotIndex];

                            if (!targetCell) {
                                console.warn(`Could not find target cell for event ${event.name} on ${day} at slot ${startSlotIndex}. Event might be outside defined grid time range.`);
                                return;
                            }

                            const eventBlock = document.createElement('div');
                            let eventClasses = ['week-event-block'];
                            const isCurrent = (day === todayName) && isCurrentEvent(event, now);

                            if (event.type === 'internship') {
                                eventClasses.push('week-internship-event');
                            } else {
                                eventClasses.push('week-class-event');
                            }

                            if (isCurrent) {
                                eventClasses.push('week-current-event');
                            }
                            
                            eventBlock.className = eventClasses.join(' ');
                            
                            // Calculate top position relative to the targetCell
                            eventBlock.style.top = `${(offsetInSlotMinutes / slotDurationMinutes) * cellHeightPx + 2}px`; // +2 for inset padding
                            
                            // Calculate height based on total duration
                            eventBlock.style.height = `${(totalDurationMinutes / slotDurationMinutes) * cellHeightPx - 4}px`; // -4 for total vertical inset padding

                            // Determine the location text based on event type
                            let locationHtml = '';
                            if (event.type === 'internship') { // Show Sync/Async for internships
                                const tagClass = event.sync ? 'week-sync-tag' : 'week-async-tag';
                                locationHtml = `<span class="${tagClass}">${event.sync ? 'Sync' : 'Async'}</span>`;
                            } else if (event.location) { // For classes, show the actual location if it exists
                                locationHtml = `<span class="location-tag">${event.location}</span>`;
                            }

                            // Apply white-space: nowrap to the time paragraph
                            eventBlock.innerHTML = `
                                <p class="font-bold">${event.name}</p>
                                <p class="text-xs" style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%; box-sizing: border-box; padding: 0;">${event.time}</p>
                                ${locationHtml}
                            `;
                            targetCell.appendChild(eventBlock); // Append to the specific cell
                        } catch (e) {
                            console.error(`Error processing event ${event.name} on ${day}:`, e);
                        }
                    });
                }
            });

            weekScheduleContainer.appendChild(grid);
        }

        // Function to render the appropriate view based on the current state
        let currentView = 'all'; // 'today', 'all', 'week'

        function renderView(viewType, filterDay = null) {
            currentView = viewType;
            if (viewType === 'week') {
                renderWeekView();
            } else {
                renderDailyView(filterDay);
            }
        }

        // Event listeners for the buttons
        showTodayBtn.addEventListener('click', () => {
            renderView('today', getTodayName());
        });

        showAllBtn.addEventListener('click', () => {
            renderView('all'); // Call without filter to show all days
        });

        showWeekBtn.addEventListener('click', () => {
            renderView('week');
        });

        // Initial render when the window loads (show all days by default)
        window.onload = () => {
            renderView('all');
            // Also, re-render every minute to keep the 'current event' highlight updated
            setInterval(() => {
                if (currentView === 'week') {
                    renderWeekView();
                } else if (currentView === 'today') {
                    renderDailyView(getTodayName());
                } else { // 'all' view
                    renderDailyView();
                }
            }, 60000);
        };
    </script>
</body>
</html>
